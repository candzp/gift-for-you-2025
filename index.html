<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Celebration Gift üéÅ</title>

  <style>
    :root{
      --bg1:#fff7ef;
      --bg2:#f3f2ff;
      --bg3:#eefbf6;
      --ink:#1b1b1b;
      --muted: rgba(0,0,0,.62);
      --card:#ffffff;
      --shadow: 0 24px 70px rgba(0,0,0,.14);
      --radius: 22px;
      --accent:#1f7a55;
      --accent2:#7c4dff;
      --accent3:#ff6b6b;
      --accent4:#ffb703;
    }

    /* Page background */
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      overflow-x:hidden;

      /* soft gradients */
      background:
        radial-gradient(900px 500px at 15% 10%, var(--bg1) 0%, transparent 60%),
        radial-gradient(900px 500px at 85% 20%, var(--bg2) 0%, transparent 62%),
        radial-gradient(900px 500px at 60% 90%, var(--bg3) 0%, transparent 62%),
        linear-gradient(180deg, #ffffff 0%, #f7f6f5 100%);
    }

    /* subtle pattern overlay using inline SVG (neutral sparkles/dots) */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.18;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220' viewBox='0 0 220 220'%3E%3Cg fill='none'%3E%3Ccircle cx='28' cy='42' r='2.2' fill='%23000000' opacity='.25'/%3E%3Ccircle cx='86' cy='24' r='1.8' fill='%23000000' opacity='.18'/%3E%3Ccircle cx='144' cy='62' r='2.4' fill='%23000000' opacity='.18'/%3E%3Ccircle cx='186' cy='38' r='1.7' fill='%23000000' opacity='.22'/%3E%3Cpath d='M52 118l4-10 4 10 10 4-10 4-4 10-4-10-10-4 10-4z' fill='%23000000' opacity='.13'/%3E%3Cpath d='M164 148l3-8 3 8 8 3-8 3-3 8-3-8-8-3 8-3z' fill='%23000000' opacity='.12'/%3E%3Cpath d='M88 176l2-6 2 6 6 2-6 2-2 6-2-6-6-2 6-2z' fill='%23000000' opacity='.12'/%3E%3C/g%3E%3C/svg%3E");
      background-size:220px 220px;
      filter: blur(.2px);
    }

    /* Confetti layer */
    .confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:0;
    }
    .confetti i{
      position:absolute;
      top:-12vh;
      width:10px;
      height:18px;
      border-radius:4px;
      opacity:.75;
      transform: rotate(12deg);
      animation: fall linear infinite;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.08));
    }
    /* different shapes */
    .confetti i:nth-child(3n){ width:8px; height:8px; border-radius:999px; }
    .confetti i:nth-child(4n){ width:12px; height:6px; border-radius:999px; }

    @keyframes fall{
      0%{ transform: translateY(-12vh) rotate(0deg); }
      100%{ transform: translateY(112vh) rotate(320deg); }
    }

    /* Firework glow bursts */
    .bursts{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:0;
      opacity:.55;
    }
    .burst{
      position:absolute;
      width:520px;
      height:520px;
      border-radius:50%;
      background:
        radial-gradient(circle at 50% 50%, rgba(255,183,3,.35) 0%, transparent 55%),
        radial-gradient(circle at 55% 45%, rgba(124,77,255,.22) 0%, transparent 55%),
        radial-gradient(circle at 45% 55%, rgba(255,107,107,.18) 0%, transparent 55%);
      filter: blur(2px);
      animation: pulse 5.5s ease-in-out infinite;
      mix-blend-mode: multiply;
    }
    .burst.b2{
      width:460px;height:460px;
      background:
        radial-gradient(circle at 50% 50%, rgba(31,122,85,.22) 0%, transparent 55%),
        radial-gradient(circle at 60% 40%, rgba(255,183,3,.20) 0%, transparent 58%),
        radial-gradient(circle at 40% 60%, rgba(124,77,255,.16) 0%, transparent 60%);
      animation-duration: 6.6s;
      animation-delay: -1.4s;
      opacity:.6;
    }
    @keyframes pulse{
      0%,100%{ transform: scale(.92); opacity:.55; }
      50%{ transform: scale(1.04); opacity:.75; }
    }

    /* Card */
    .wrap{
      position:relative;
      z-index:1;
      width:min(720px,92vw);
      padding: 14px;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:26px;
      border: 1px solid rgba(0,0,0,.06);
      position:relative;
      overflow:hidden;
    }

    /* cute top ribbon */
    .card::before{
      content:"";
      position:absolute;
      inset:-2px -2px auto -2px;
      height:64px;
      background:
        linear-gradient(90deg,
          rgba(255,183,3,.22),
          rgba(124,77,255,.18),
          rgba(31,122,85,.20),
          rgba(255,107,107,.18)
        );
      filter: blur(10px);
      opacity:.9;
    }

    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      position:relative;
    }
    h1{ margin:0 0 6px; font-size:28px; letter-spacing:.2px; }
    .tag{ color:var(--muted); font-size:14px; margin-bottom:10px; }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(0,0,0,.04);
      border: 1px solid rgba(0,0,0,.06);
      font-size:13px;
      white-space:nowrap;
      backdrop-filter: blur(6px);
    }
    .badge b{ font-weight:800; }

    p{ line-height:1.5; margin:10px 0; }

    /* Inputs + buttons */
    .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    input{
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(0,0,0,.14);
      font-size:16px;
      flex:1;
      min-width:180px;
      outline:none;
      background: rgba(255,255,255,.85);
    }
    input:focus{
      border-color: rgba(124,77,255,.55);
      box-shadow: 0 0 0 4px rgba(124,77,255,.12);
    }

    button, a.btn{
      border:0;
      border-radius:14px;
      padding:12px 14px;
      font-weight:800;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    button{
      background: var(--accent);
      color:#fff;
      box-shadow: 0 12px 26px rgba(31,122,85,.22);
    }
    button:hover{ filter: brightness(1.03); }
    button:disabled{ opacity:.6; cursor:not-allowed; box-shadow:none; }

    a.btn.secondary{
      background:#2a2a2a;
      color:#fff;
      box-shadow: 0 12px 26px rgba(0,0,0,.18);
    }

    /* Code box */
    .code{
      margin:16px 0 6px;
      padding:14px;
      border-radius:16px;
      background:
        linear-gradient(180deg, rgba(0,0,0,.03), rgba(0,0,0,.02));
      border:1px dashed rgba(0,0,0,.18);
      font: 750 16px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      word-break:break-all;
      position:relative;
    }
    .code::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius:16px;
      pointer-events:none;
      background:
        radial-gradient(420px 140px at 20% 0%, rgba(255,183,3,.18), transparent 60%),
        radial-gradient(420px 160px at 80% 0%, rgba(124,77,255,.14), transparent 60%);
      opacity:.9;
    }

    .muted{ font-size:13px; color:var(--muted); }
    .divider{ height:1px; background: rgba(0,0,0,.07); margin:18px 0; }
    .steps{
      background: rgba(0,0,0,.03);
      border: 1px solid rgba(0,0,0,.06);
      border-radius:16px;
      padding:14px;
      font-size:14px;
    }
    .steps ol{ padding-left:18px; margin:8px 0; }
    .steps li{ margin:7px 0; }
    .hidden{ display:none; }
    .error{ margin-top:10px; color:#b00020; font-size:13px; }
    .ps{ font-style:italic; font-size:14px; }

    /* Small footer sparkle line */
    .sparkline{
      display:flex; align-items:center; gap:10px;
      margin-top:14px;
      color: rgba(0,0,0,.5);
      font-size:12px;
    }
    .sparkline::before, .sparkline::after{
      content:"";
      height:1px;
      flex:1;
      background: linear-gradient(90deg, transparent, rgba(0,0,0,.14), transparent);
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      .confetti i, .burst{ animation:none !important; }
    }
  </style>
</head>

<body>
  <!-- Background effects -->
  <div class="bursts" aria-hidden="true">
    <div class="burst" style="left:-120px; top:-120px;"></div>
    <div class="burst b2" style="right:-160px; top:20px;"></div>
    <div class="burst" style="left:20%; bottom:-220px; opacity:.45;"></div>
  </div>

  <div class="confetti" aria-hidden="true" id="confetti"></div>

  <div class="wrap">
    <main class="card">
      <div class="top">
        <div>
          <h1>Season‚Äôs Greetings ‚ú®</h1>
          <div class="tag">Lazada Digital Gift Code</div>
        </div>
        <div class="badge" title="Helps you know if this is your first or second QR.">
          üéÅ <b>Gift Code</b> <span id="codeNum">#?</span>
        </div>
      </div>

      <p>
        Happy Holidays and Happy New Year! 
        
        Here‚Äôs a little gift for you üéâ
      </p>

      <h2>Unlock your code</h2>
      <div class="row">
        <input id="pin" inputmode="numeric" placeholder="Enter your PIN" />
        <button id="unlockBtn">Unlock ‚ú®</button>
      </div>
      <p class="muted">
        Your QR contains an <b>encrypted</b> gift code. The PIN unlocks it on your device.
      </p>

      <div id="err" class="error"></div>

      <div id="reveal" class="hidden">
        <div class="code" id="giftCode">‚Äî</div>
        <p class="muted">Expiry: <b>10/01/2045</b></p>

        <div class="row">
          <button id="copyBtn">Copy code üìã</button>
          <a class="btn secondary"
             href="https://play.google.com/store/apps/details?id=com.lazada.android"
             target="_blank" rel="noreferrer">
             Get Lazada App (Android)
          </a>
        </div>

        <p class="muted">
          iPhone / iPad: open the App Store and search <b>‚ÄúLazada‚Äù</b>.
        </p>

        <div class="divider"></div>

        <h2>How to redeem in the Lazada app</h2>
        <div class="steps">
          <ol>
            <li>Open the <b>Lazada app</b> and log in.</li>
            <li>Go to the <b>Account</b> tab.</li>
            <li>Select <b>Lazada Wallet</b>.</li>
            <li>Tap <b>Gift Card</b>.</li>
            <li>Paste the code and tap <b>Redeem</b>.</li>
          </ol>
          <p class="muted">
            You have <b>two gift codes</b> ‚Äî please scan your second QR to unlock the other one.
          </p>
        </div>

        <div class="divider"></div>

        <h2>P.S.</h2>
        <div class="steps">
          <p class="ps">If you run into issues, contact me üì´</p>
        </div>

        <div class="sparkline" aria-hidden="true">‚ú® üéÜ üéâ ‚ú®</div>
      </div>
    </main>
  </div>

<script>
  // --- Confetti generator (neutral colors) ---
  (function makeConfetti(){
    const holder = document.getElementById("confetti");
    const colors = ["#1f7a55","#7c4dff","#ff6b6b","#ffb703","#2a2a2a"];
    const count = 22; // keep light
    for(let i=0;i<count;i++){
      const el = document.createElement("i");
      const left = Math.random()*100;
      const delay = -Math.random()*10;
      const dur = 7 + Math.random()*8;
      const size = 0.8 + Math.random()*1.2;

      el.style.left = left + "vw";
      el.style.animationDuration = dur + "s";
      el.style.animationDelay = delay + "s";
      el.style.transform = `rotate(${Math.random()*40}deg) scale(${size})`;
      el.style.background = colors[Math.floor(Math.random()*colors.length)];
      el.style.opacity = (0.45 + Math.random()*0.45).toFixed(2);
      holder.appendChild(el);
    }
  })();

  // --- Gift unlock logic (Option B) ---
  // Fragment format:
  // #enc.<saltB64url>.<ivB64url>.<ctB64url>&n=1|2
  const rawFrag = (location.hash || "").slice(1);

  const errEl = document.getElementById("err");
  const reveal = document.getElementById("reveal");
  const codeEl = document.getElementById("giftCode");
  const pinEl = document.getElementById("pin");
  const unlockBtn = document.getElementById("unlockBtn");
  const codeNumEl = document.getElementById("codeNum");

  function parseFrag(f){
    let encPart = f;
    let n = "";
    const m = f.match(/&n=(\d+)/);
    if (m) n = m[1];
    encPart = f.split("&n=")[0];
    return { encPart, n };
  }

  const parsed = parseFrag(rawFrag);
  codeNumEl.textContent = parsed.n ? `#${parsed.n}` : "#?";

  // Copy button
  const copyBtn = document.getElementById("copyBtn");
  copyBtn.onclick = async () => {
    try {
      await navigator.clipboard.writeText(codeEl.textContent);
      copyBtn.textContent = "Copied ‚úì";
      setTimeout(()=>copyBtn.textContent="Copy code üìã",1500);
    } catch {
      alert("Copy failed. You can manually select and copy the code.");
    }
  };

  function b64urlToBytes(s){
    s = s.replace(/-/g,'+').replace(/_/g,'/');
    while (s.length % 4) s += '=';
    const bin = atob(s);
    return Uint8Array.from(bin, c => c.charCodeAt(0));
  }

  async function deriveKey(pin, saltBytes){
    const enc = new TextEncoder();
    const keyMaterial = await crypto.subtle.importKey("raw", enc.encode(pin), "PBKDF2", false, ["deriveKey"]);
    return crypto.subtle.deriveKey(
      { name:"PBKDF2", salt:saltBytes, iterations:150000, hash:"SHA-256" },
      keyMaterial,
      { name:"AES-GCM", length:256 },
      false,
      ["decrypt"]
    );
  }

  async function decryptWithPin(pin){
    const encFrag = parsed.encPart;
    if(!encFrag.startsWith("enc.")) throw new Error("Invalid QR data. Please scan the QR again.");
    const parts = encFrag.split(".");
    if(parts.length !== 4) throw new Error("Invalid QR data format. Please scan the QR again.");

    const salt = b64urlToBytes(parts[1]);
    const iv   = b64urlToBytes(parts[2]);
    const ct   = b64urlToBytes(parts[3]);

    const key = await deriveKey(pin, salt);
    const ptBuf = await crypto.subtle.decrypt({ name:"AES-GCM", iv }, key, ct);
    return new TextDecoder().decode(ptBuf);
  }

  function clearUrlFragment(){
    try { history.replaceState(null, "", location.pathname + location.search); } catch {}
  }

  unlockBtn.onclick = async () => {
    errEl.textContent = "";
    try{
      const pin = pinEl.value.trim();
      if(!pin) throw new Error("Please enter your PIN.");
      if(!rawFrag) throw new Error("No encrypted data found. Please scan the QR again.");

      unlockBtn.disabled = true;

      const code = await decryptWithPin(pin);
      codeEl.textContent = code;

      reveal.classList.remove("hidden");
      pinEl.value = "";
      clearUrlFragment();
    }catch(e){
      errEl.textContent = e.message || String(e);
      alert("Could not unlock. Please check your PIN and try again.");
    } finally {
      unlockBtn.disabled = false;
    }
  };
</script>
</body>
</html>
